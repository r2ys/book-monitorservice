# Introduction

## 企业应用监控方案统一管理

### 目标

本文从以下出发点入手，旨在针对所有业务系统、中台服务、基础服务等制定统一的监控告警标准。

* [Introduction](README.md)
* [监控维度](metrics/README.md)
* [业务监控](biz/README.md)
* [链路监控](trace/README.md)



### 需求调研

**如何建设生产环境下的系统可观测性能力**

监控报警是业务系统的金钟罩，对业务系统非常重要。不存在不出问题、没有 Bug 的系统。系统上线之后，就免不了出现故障，出故障是或早或晚的事，是或多或少的事。我们能做的是，出现故障之后，第一时间知道，赶紧处理，防止影响扩大。再理想点，如果故障出现之前，刚有苗头的时候，我们就能发现，提前解决就更好了。业务系统的监控报警，就是干这个用的。

线上bug反馈：用户-客服-产品负责人/项目负责人-开发

如何做到快速发现bug ：代码埋点、响应码、异常处理

如何做到出现之前就发现：举例：

三方响应时间预期是2秒，程序设置超时时间是5s，通过对响应时间进行监控，在接近5秒时就主动预警，通过联系下游渠道解决，就杜绝了超时之后告警的问题。

怎么让第三方对我们的影响最小呢？一是，同一个服务，尽量多接几家第三方，然后我们自己做个路由。就算是其中一家掉链子了，我们能快速切换到另外一家。另外，我们自己主动检测第三方的服务，在用户使用高峰到来之前，自己主动发起几笔业务，测测第三方的服务是否正常。对我们系统来说，越是重要的第三方服务（例如支付），越应该做好预防工作。



先搞清楚系统高峰时段，再就是，从用户角度出发，记录每个功能服务的响应时间，发现慢的及时优化。注意，一定是按照用户角度去观测，不要只看单个服务的响应时间，或者单条 SQL 的执行时间，因为有的功能包含了多个服务，或者多个 SQL 执行。单独看服务或者 SQL 都不慢，但是合在一起，总时间可能就很长。



告警方式：

重要的问题使用短信、微信进行通知，不太重要的问题用邮件通知。为了防止有人看不到，一般同时多通知几个人，可以互相提醒

监控指标：

最基础：监控服务器的存储、内存、CPU



**监控与告警的区别：**其实本质上监控是告警的基础，只有具备了监控的信息，才能针对监控的信息去指定相应的规则和策略来进行告警。



监控和告警的目标则是一致的，即：

- 全面：监控与告警的广度，尽可能多的覆盖到故障类型
- 及时：数据处理和传递的时效性，快速的将告警信息暴露出来
- 准确：保证监控和告警信息的准确性，避免浪费相应的资源去解决错误的告警。



一个告警规则和策略需要包含告警的统计指标，告警推送的条件、告警的收敛规则。

- 告警名称：网络故障告警
- 告警指标：网络速度
- 告警条件：网络速度小于20kb/s
- 统计时间：30分钟
- 发生次数：3次

表示：当某台设备30分钟内上报网速小于20kb/s大于等于3次时触发告警



系统的可观测性方案包括指标、日志、链路追踪、K8s Event 事件、NPD 框架等方式。每种方式可以从不同维度透视 Kubernetes 系统的状态和数据。在生产环境，我们通常需要综合使用各种方式，有时候还要运用多种方式联动观测，形成完善立体的可观测性体系，提高对各种场景的覆盖度，进而提升 Kubernetes 系统的整体稳定性。下面会概述生产环境下对 K8s 系统的可观测性解决方案。



硬件：服务器资源、网络；cpu、mem , 网络，io，raid，负载；故障

k8s

容器

服务应用监控：出错、慢接口的快速定位；业务响应时长、响应次数和错误率；异常监控；主要是性能异常和调用链；日志；jvm

业务监控：接口调用记录；调用异常；实时计算和分析

中间件

db：性能、日志

工作线程

打点数据和阈值

链路断点设置(包含负载、服务容错)：链路监控、业务属性监控

主动发起事件

告警



攻击和流量防护

c端页面监控：页面打开速度、页面稳定性；用户页面浏览的性能和错误情况











## 附录

### 参考文档：

[基于Telegraf Influxdb Grafana的监控平台介绍](http://www.360doc.com/content/19/1011/20/54737980_866206874.shtml)

[Telegraf开源组件](https://github.com/influxdata/telegraf)

[cAdvisor InfluxDB Grafana搭建监控平台](http://book.akhack.com/swarm/_book/swarm_book/%E7%BE%A4%E9%9B%86%E7%9B%91%E6%8E%A7.html)

[基于Telegraf的数据收集系统](https://cloud.tencent.com/developer/news/377267)

[使用Prometheus+Grafana快速打造高逼格监控平台](https://zhuanlan.zhihu.com/p/75188816)

[Telegraf 使用](https://blog.csdn.net/youngtong/article/details/84640382)

[指标与日志的监控告警系统设计](https://zhuanlan.zhihu.com/p/345562326)

[一篇文章了解监控告警](https://zhuanlan.zhihu.com/p/60416209)

[如何专业化监测一个 Kubernetes 集群？](https://mp.weixin.qq.com/s?__biz=MzU4NzU0MDIzOQ==&mid=2247495067&idx=2&sn=8274481d8f0304663ad9a407526831ae&chksm=fde8dffbca9f56ed50eb6eb0c8e8c3a75aeaaa02f9918689e33a764207541bc0c698fbabc365&mpshare=1&scene=1&srcid=0531DNFCaBDdBzThyZZ2Gsex&sharer_sharetime=1622469135139&sharer_shareid=cbc82124cedc2b0864b983af90cce39a#rd)

[接口链路统计](https://www.cnblogs.com/huane/p/6025498.html)

[阿里云ARMS链路监控](https://zhuanlan.zhihu.com/p/321792372)

[浅谈全链路监控](https://www.cnblogs.com/imyalost/p/10941216.html)

[Prometheus学习](https://mp.weixin.qq.com/s?__biz=MzUzMTA2NTU2Ng==&mid=2247517826&idx=2&sn=a14d699d30132942c322ff6ac9d3cb0d&chksm=fa4af933cd3d70258d15b63699b5d8ce1c9cbf0c2b462ce4b753e211ed2be20647fb0873e7f8&scene=0&xtrack=1#rd)

